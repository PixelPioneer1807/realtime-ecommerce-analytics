-- ===================================================================
--  TABLE: ml_predictions
--  PURPOSE:
--    Store cart abandonment predictions generated by ML API
-- ===================================================================

CREATE TABLE IF NOT EXISTS ml_predictions (
    prediction_id SERIAL PRIMARY KEY,
    
    -- Session info
    session_id VARCHAR(50) NOT NULL,
    user_id INT,
    
    -- Prediction metadata
    prediction_timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    abandonment_probability DECIMAL(6,4) NOT NULL,
    predicted_abandoned BOOLEAN NOT NULL DEFAULT TRUE,
    risk_level VARCHAR(20) NOT NULL,
    
    -- Intervention info
    intervention_triggered BOOLEAN DEFAULT FALSE,
    intervention_type VARCHAR(200),
    intervention_timestamp TIMESTAMP,
    
    -- Actual result (to be updated later)
    actual_outcome VARCHAR(20),
    was_prediction_correct BOOLEAN,
    
    -- Model info
    model_version VARCHAR(50) DEFAULT 'random_forest_v1',
    prediction_latency_ms INTEGER,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS idx_predictions_session ON ml_predictions (session_id);
CREATE INDEX IF NOT EXISTS idx_predictions_timestamp ON ml_predictions (prediction_timestamp);
CREATE INDEX IF NOT EXISTS idx_predictions_risk ON ml_predictions (risk_level);
